{"ast":null,"code":"import _objectSpread from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/dr.mac/projectRailway/railway-reservation-system-master/web/src/components/Home.js\";\nimport React, { Component } from 'react';\nimport { routes, route, trainsByRoute, classes, schedules } from '../Services';\nimport { Button, Form, Col, Row, Table } from 'react-bootstrap';\nimport Select from 'react-select';\nimport DatePicker from \"react-datepicker\";\nimport moment from 'moment';\n\nvar Home =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Home, _Component);\n\n  function Home(props) {\n    var _this;\n\n    _classCallCheck(this, Home);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Home).call(this, props));\n\n    _this.handleQtyChange = function () {\n      return function (event) {\n        _this.setState({\n          qty: event.target.value\n        }, function () {\n          return _this.calculateFair();\n        });\n      };\n    };\n\n    _this.calculateFair = function () {\n      var user = localStorage.getItem('user');\n\n      if (user) {\n        user = JSON.parse(user);\n      }\n\n      if (_this.state.to && _this.state.from && _this.state.trainClass && _this.state.qty) {\n        var amount = Math.abs(_this.state.to.fair - _this.state.from.fair) * _this.state.trainClass.fairRatio * _this.state.qty;\n\n        amount = amount.toFixed(2);\n        var discount = (user && user.discount ? 0.1 * amount : 0).toFixed(2);\n        var total = (amount - discount).toFixed(2);\n\n        _this.setState({\n          amount: amount,\n          discount: discount,\n          total: total\n        });\n      }\n    };\n\n    _this.handleSubmit = function (event) {\n      _this.setState({\n        showErr: false\n      });\n\n      var state = _this.state;\n      var user = localStorage.getItem('user');\n\n      if (!user) {\n        alert(\"Please Sign In Before Make a Reservation!!!\");\n\n        _this.props.history.push('/');\n      } else if (state.from && state.to && state.train && state.trainClass && state.time && state.qty && state.date) {\n        _this.props.history.push(\"/payment\", _objectSpread({}, _this.state));\n      } else {\n        _this.setState({\n          showErr: true\n        });\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n    };\n\n    _this.handleDateChange = function (dt) {\n      var date = moment(dt).format('YYYY-MM-DD');\n\n      _this.setState({\n        date: date\n      });\n    };\n\n    _this.state = {\n      fromOptions: [],\n      toOptions: [],\n      trains: [],\n      errMsg: 'Please fill all the fields!!!',\n      showErr: false\n    };\n    return _this;\n  }\n\n  _createClass(Home, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var options = [];\n      routes().then(function (res) {\n        res.map(function (item, i) {\n          return item.route.map(function (station, i) {\n            return options.push({\n              value: station.name,\n              label: station.name,\n              route: item._id,\n              id: i,\n              fair: station.fair\n            });\n          });\n        });\n\n        _this2.setState({\n          fromOptions: options\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    } //\n    //        classes()\n    //            .then(res => {\n    //                var classes = []\n    //                res.map((trainClass, i) => {\n    //                    return classes.push({ value: trainClass.name, label: trainClass.name, id: trainClass._id, fairRatio: trainClass.fairRatio })\n    //                })\n    //                this.setState({ classes: classes })\n    //            })\n    //            .catch(err => {\n    //                console.log(err)\n    //            })\n    //        schedules()\n    //            .then(res => {\n    //                var schedules = []\n    //                res.map((schedule, i) => {\n    //                    return schedules.push({ value: schedule.time, label: schedule.time, id: schedule._id })\n    //                })\n    //                this.setState({ schedules: schedules })\n    //            })\n    //            .catch(err => {\n    //                console.log(err)\n    //            })\n    //\n    //    }\n    //\n    //    handleChange = type => selectedOption => {\n    //        this.setState({ [type]: selectedOption }, () => {\n    //            this.calculateFair()\n    //        });\n    //        if (type === 'from') {\n    //            this.setState({ to: '', train: '' })\n    //            route(selectedOption.route)\n    //                .then(res => {\n    //                    var options = [];\n    //                    res.route.map((station, i) => {\n    //                        return options.push({ value: station.name, label: station.name, route: res._id, id: i, fair: station.fair })\n    //                    })\n    //                    this.setState({ toOptions: options })\n    //                })\n    //                .catch(err => {\n    //                    console.log(err)\n    //                })\n    //            trainsByRoute(selectedOption.route)\n    //                .then(res => {\n    //                    var options = [];\n    //                    res.map((train, i) => {\n    //                        return options.push({ value: train.name, label: train.name, id: train._id })\n    //                    })\n    //                    this.setState({ trains: options })\n    //                })\n    //                .catch(err => {\n    //                    console.log(err)\n    //                })\n    //        }\n    //    }\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(Form, {\n        style: {\n          padding: 20\n        },\n        onSubmit: function onSubmit(e) {\n          return _this3.handleSubmit(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, React.createElement(Row, {\n        style: {\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, React.createElement(Form.Row, {\n        style: {\n          width: '75%',\n          borderBottom: '1px solid rgb(200,200,200)',\n          marginBottom: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }, React.createElement(\"h4\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, \"Book Train Tickets\")), React.createElement(Form.Row, {\n        style: {\n          width: '75%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"from\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, \"From\"), React.createElement(Select, {\n        options: this.state.fromOptions,\n        onChange: this.handleChange(\"from\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"to\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, \"To\"), React.createElement(Select, {\n        options: this.state.toOptions,\n        onChange: this.handleChange(\"to\"),\n        value: this.state.to,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }))), React.createElement(Form.Row, {\n        style: {\n          width: '75%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"from\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, \"Train\"), React.createElement(Select, {\n        options: this.state.trains,\n        onChange: this.handleChange(\"train\"),\n        value: this.state.train,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"to\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, \"Class\"), React.createElement(Select, {\n        options: this.state.classes,\n        onChange: this.handleChange(\"trainClass\"),\n        value: this.state.trainClass,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }))), React.createElement(Form.Row, {\n        style: {\n          width: '75%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"from\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, \"Time\"), React.createElement(Select, {\n        options: this.state.schedules,\n        onChange: this.handleChange(\"time\"),\n        value: this.state.time,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      })), React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"formGridEmail\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, \"No of Tickets\"), React.createElement(Form.Control, {\n        placeholder: \"qty\",\n        onChange: this.handleQtyChange(),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }))), React.createElement(Form.Row, {\n        style: {\n          width: '75%',\n          paddingBottom: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(Col, {\n        md: 6,\n        lg: 6,\n        xl: 6,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, \"Date\"), React.createElement(DatePicker, {\n        className: \"form-control\",\n        onChange: this.handleDateChange,\n        minDate: new Date(),\n        value: this.state.date,\n        placeholderText: \"YYYY-MM-DD\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }))), React.createElement(Form.Row, {\n        style: {\n          width: '75%',\n          paddingLeft: 5,\n          align: 'right'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, this.state.amount && React.createElement(Table, {\n        striped: true,\n        bordered: true,\n        hover: true,\n        size: \"sm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, \"Amount\"), React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, this.state.amount, \" LKR\")), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, \"Discount\"), React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, this.state.discount, \" LKR\")), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, \"Total\"), React.createElement(\"td\", {\n        align: \"right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, this.state.total, \" LKR\"))))), React.createElement(Form.Row, {\n        style: {\n          width: '75%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, this.state.showErr && React.createElement(\"p\", {\n        style: {\n          color: 'red'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, this.state.errMsg)), React.createElement(Form.Row, {\n        style: {\n          width: '75%',\n          padding: 5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(Button, {\n        variant: \"primary\",\n        type: \"submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, \"Make Reservation\"))));\n    }\n  }]);\n\n  return Home;\n}(Component);\n\nexport default Home;","map":{"version":3,"sources":["/Users/dr.mac/projectRailway/railway-reservation-system-master/web/src/components/Home.js"],"names":["React","Component","routes","route","trainsByRoute","classes","schedules","Button","Form","Col","Row","Table","Select","DatePicker","moment","Home","props","handleQtyChange","event","setState","qty","target","value","calculateFair","user","localStorage","getItem","JSON","parse","state","to","from","trainClass","amount","Math","abs","fair","fairRatio","toFixed","discount","total","handleSubmit","showErr","alert","history","push","train","time","date","preventDefault","stopPropagation","handleDateChange","dt","format","fromOptions","toOptions","trains","errMsg","options","then","res","map","item","i","station","name","label","_id","id","catch","err","console","log","padding","e","alignItems","justifyContent","width","borderBottom","marginBottom","handleChange","paddingBottom","Date","paddingLeft","align","color"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,EAAiBC,KAAjB,EAAwBC,aAAxB,EAAuCC,OAAvC,EAAgDC,SAAhD,QAAiE,aAAjE;AAEA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,GAAvB,EAA4BC,GAA5B,EAAiCC,KAAjC,QAA8C,iBAA9C;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,OAAOC,MAAP,MAAmB,QAAnB;;IAEMC,I;;;;;AAEF,gBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,8EAAMA,KAAN;;AADe,UAmFnBC,eAnFmB,GAmFD;AAAA,aAAM,UAAAC,KAAK,EAAI;AAC7B,cAAKC,QAAL,CAAc;AAAEC,UAAAA,GAAG,EAAEF,KAAK,CAACG,MAAN,CAAaC;AAApB,SAAd,EAA2C;AAAA,iBAAM,MAAKC,aAAL,EAAN;AAAA,SAA3C;AACH,OAFiB;AAAA,KAnFC;;AAAA,UAuFnBA,aAvFmB,GAuFH,YAAM;AAClB,UAAIC,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX;;AACA,UAAIF,IAAJ,EAAU;AACNA,QAAAA,IAAI,GAAGG,IAAI,CAACC,KAAL,CAAWJ,IAAX,CAAP;AACH;;AACD,UAAI,MAAKK,KAAL,CAAWC,EAAX,IAAiB,MAAKD,KAAL,CAAWE,IAA5B,IAAoC,MAAKF,KAAL,CAAWG,UAA/C,IAA6D,MAAKH,KAAL,CAAWT,GAA5E,EAAiF;AAC7E,YAAIa,MAAM,GAAGC,IAAI,CAACC,GAAL,CAAS,MAAKN,KAAL,CAAWC,EAAX,CAAcM,IAAd,GAAqB,MAAKP,KAAL,CAAWE,IAAX,CAAgBK,IAA9C,IAAsD,MAAKP,KAAL,CAAWG,UAAX,CAAsBK,SAA5E,GAAwF,MAAKR,KAAL,CAAWT,GAAhH;;AACAa,QAAAA,MAAM,GAAGA,MAAM,CAACK,OAAP,CAAe,CAAf,CAAT;AACA,YAAIC,QAAQ,GAAG,CAACf,IAAI,IAAIA,IAAI,CAACe,QAAb,GAAwB,MAAMN,MAA9B,GAAuC,CAAxC,EAA2CK,OAA3C,CAAmD,CAAnD,CAAf;AACA,YAAIE,KAAK,GAAG,CAACP,MAAM,GAAGM,QAAV,EAAoBD,OAApB,CAA4B,CAA5B,CAAZ;;AACA,cAAKnB,QAAL,CAAc;AAAEc,UAAAA,MAAM,EAAEA,MAAV;AAAkBM,UAAAA,QAAQ,EAAEA,QAA5B;AAAsCC,UAAAA,KAAK,EAAEA;AAA7C,SAAd;AACH;AACJ,KAnGkB;;AAAA,UAqGnBC,YArGmB,GAqGJ,UAAAvB,KAAK,EAAI;AACpB,YAAKC,QAAL,CAAc;AAAEuB,QAAAA,OAAO,EAAE;AAAX,OAAd;;AACA,UAAMb,KAAK,GAAG,MAAKA,KAAnB;AACA,UAAIL,IAAI,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX;;AACA,UAAI,CAACF,IAAL,EAAW;AACPmB,QAAAA,KAAK,CAAC,6CAAD,CAAL;;AACA,cAAK3B,KAAL,CAAW4B,OAAX,CAAmBC,IAAnB,CAAwB,GAAxB;AACH,OAHD,MAGO,IAAIhB,KAAK,CAACE,IAAN,IAAcF,KAAK,CAACC,EAApB,IAA0BD,KAAK,CAACiB,KAAhC,IAAyCjB,KAAK,CAACG,UAA/C,IAA6DH,KAAK,CAACkB,IAAnE,IAA2ElB,KAAK,CAACT,GAAjF,IAAwFS,KAAK,CAACmB,IAAlG,EAAwG;AAC3G,cAAKhC,KAAL,CAAW4B,OAAX,CAAmBC,IAAnB,CAAwB,UAAxB,oBAAyC,MAAKhB,KAA9C;AACH,OAFM,MAEA;AACH,cAAKV,QAAL,CAAc;AAAEuB,UAAAA,OAAO,EAAE;AAAX,SAAd;AACH;;AACDxB,MAAAA,KAAK,CAAC+B,cAAN;AACA/B,MAAAA,KAAK,CAACgC,eAAN;AAEH,KApHkB;;AAAA,UAsHnBC,gBAtHmB,GAsHA,UAAAC,EAAE,EAAI;AACrB,UAAMJ,IAAI,GAAGlC,MAAM,CAACsC,EAAD,CAAN,CAAWC,MAAX,CAAkB,YAAlB,CAAb;;AACA,YAAKlC,QAAL,CAAc;AAAE6B,QAAAA,IAAI,EAAEA;AAAR,OAAd;AACH,KAzHkB;;AAEf,UAAKnB,KAAL,GAAa;AACTyB,MAAAA,WAAW,EAAE,EADJ;AAETC,MAAAA,SAAS,EAAE,EAFF;AAGTC,MAAAA,MAAM,EAAE,EAHC;AAITC,MAAAA,MAAM,EAAE,+BAJC;AAKTf,MAAAA,OAAO,EAAE;AALA,KAAb;AAFe;AASlB;;;;wCAEmB;AAAA;;AAChB,UAAIgB,OAAO,GAAG,EAAd;AACAxD,MAAAA,MAAM,GACDyD,IADL,CACU,UAAAC,GAAG,EAAI;AACRA,QAAAA,GAAG,CAACC,GAAJ,CAAQ,UAACC,IAAD,EAAOC,CAAP,EAAa;AAClB,iBAAOD,IAAI,CAAC3D,KAAL,CAAW0D,GAAX,CAAe,UAACG,OAAD,EAAUD,CAAV,EAAgB;AAClC,mBAAOL,OAAO,CAACb,IAAR,CAAa;AAAEvB,cAAAA,KAAK,EAAE0C,OAAO,CAACC,IAAjB;AAAuBC,cAAAA,KAAK,EAAEF,OAAO,CAACC,IAAtC;AAA4C9D,cAAAA,KAAK,EAAE2D,IAAI,CAACK,GAAxD;AAA6DC,cAAAA,EAAE,EAAEL,CAAjE;AAAoE3B,cAAAA,IAAI,EAAE4B,OAAO,CAAC5B;AAAlF,aAAb,CAAP;AACH,WAFM,CAAP;AAGH,SAJA;;AAKD,QAAA,MAAI,CAACjB,QAAL,CAAc;AAAEmC,UAAAA,WAAW,EAAEI;AAAf,SAAd;AACH,OARL,EASKW,KATL,CASW,UAAAC,GAAG,EAAI;AACVC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACH,OAXL;AAYK,K,CACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;6BA0Ca;AAAA;;AACL,aACI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAE;AAAEG,UAAAA,OAAO,EAAE;AAAX,SAAb;AAA8B,QAAA,QAAQ,EAAE,kBAACC,CAAD;AAAA,iBAAO,MAAI,CAACjC,YAAL,CAAkBiC,CAAlB,CAAP;AAAA,SAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,GAAD;AAAK,QAAA,KAAK,EAAE;AAAEC,UAAAA,UAAU,EAAE,QAAd;AAAwBC,UAAAA,cAAc,EAAE;AAAxC,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAEC,UAAAA,KAAK,EAAE,KAAT;AAAgBC,UAAAA,YAAY,EAAE,4BAA9B;AAA4DC,UAAAA,YAAY,EAAE;AAA1E,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADJ,CADJ,EAII,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAEF,UAAAA,KAAK,EAAE;AAAT,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAEpE,GAAhB;AAAqB,QAAA,SAAS,EAAC,MAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,EAEI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKoB,KAAL,CAAWyB,WAA5B;AAAyC,QAAA,QAAQ,EAAE,KAAK0B,YAAL,CAAkB,MAAlB,CAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ,EAKI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAEvE,GAAhB;AAAqB,QAAA,SAAS,EAAC,IAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,EAEI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKoB,KAAL,CAAW0B,SAA5B;AAAuC,QAAA,QAAQ,EAAE,KAAKyB,YAAL,CAAkB,IAAlB,CAAjD;AAA0E,QAAA,KAAK,EAAE,KAAKnD,KAAL,CAAWC,EAA5F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CALJ,CAJJ,EAcI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAE+C,UAAAA,KAAK,EAAE;AAAT,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAEpE,GAAhB;AAAqB,QAAA,SAAS,EAAC,MAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADJ,EAEI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKoB,KAAL,CAAW2B,MAA5B;AAAoC,QAAA,QAAQ,EAAE,KAAKwB,YAAL,CAAkB,OAAlB,CAA9C;AAA0E,QAAA,KAAK,EAAE,KAAKnD,KAAL,CAAWiB,KAA5F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ,EAKI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAErC,GAAhB;AAAqB,QAAA,SAAS,EAAC,IAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADJ,EAEI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKoB,KAAL,CAAWxB,OAA5B;AAAqC,QAAA,QAAQ,EAAE,KAAK2E,YAAL,CAAkB,YAAlB,CAA/C;AAAgF,QAAA,KAAK,EAAE,KAAKnD,KAAL,CAAWG,UAAlG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CALJ,CAdJ,EAwBI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAE6C,UAAAA,KAAK,EAAE;AAAT,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAEpE,GAAhB;AAAqB,QAAA,SAAS,EAAC,MAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,EAEI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKoB,KAAL,CAAWvB,SAA5B;AAAuC,QAAA,QAAQ,EAAE,KAAK0E,YAAL,CAAkB,MAAlB,CAAjD;AAA4E,QAAA,KAAK,EAAE,KAAKnD,KAAL,CAAWkB,IAA9F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ,EAKI,oBAAC,IAAD,CAAM,KAAN;AAAY,QAAA,EAAE,EAAEtC,GAAhB;AAAqB,QAAA,SAAS,EAAC,eAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBADJ,EAEI,oBAAC,IAAD,CAAM,OAAN;AAAc,QAAA,WAAW,EAAC,KAA1B;AAAgC,QAAA,QAAQ,EAAE,KAAKQ,eAAL,EAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CALJ,CAxBJ,EAkCI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAE4D,UAAAA,KAAK,EAAE,KAAT;AAAgBI,UAAAA,aAAa,EAAE;AAA/B,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,GAAD;AAAK,QAAA,EAAE,EAAE,CAAT;AAAY,QAAA,EAAE,EAAE,CAAhB;AAAmB,QAAA,EAAE,EAAE,CAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,EAEI,oBAAC,UAAD;AACI,QAAA,SAAS,EAAC,cADd;AAEI,QAAA,QAAQ,EAAE,KAAK9B,gBAFnB;AAGI,QAAA,OAAO,EAAE,IAAI+B,IAAJ,EAHb;AAII,QAAA,KAAK,EAAE,KAAKrD,KAAL,CAAWmB,IAJtB;AAKI,QAAA,eAAe,EAAC,YALpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ,CAlCJ,EA8CI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAE6B,UAAAA,KAAK,EAAE,KAAT;AAAgBM,UAAAA,WAAW,EAAE,CAA7B;AAAgCC,UAAAA,KAAK,EAAE;AAAvC,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK,KAAKvD,KAAL,CAAWI,MAAX,IACG,oBAAC,KAAD;AAAO,QAAA,OAAO,MAAd;AAAe,QAAA,QAAQ,MAAvB;AAAwB,QAAA,KAAK,MAA7B;AAA8B,QAAA,IAAI,EAAC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,EAEI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAmB,KAAKJ,KAAL,CAAWI,MAA9B,SAFJ,CADJ,EAKI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADJ,EAEI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAmB,KAAKJ,KAAL,CAAWU,QAA9B,SAFJ,CALJ,EASI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADJ,EAEI;AAAI,QAAA,KAAK,EAAC,OAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAmB,KAAKV,KAAL,CAAWW,KAA9B,SAFJ,CATJ,CADJ,CAFR,CA9CJ,EAkEI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAEqC,UAAAA,KAAK,EAAE;AAAT,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK,KAAKhD,KAAL,CAAWa,OAAX,IAAsB;AAAG,QAAA,KAAK,EAAE;AAAE2C,UAAAA,KAAK,EAAE;AAAT,SAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA6B,KAAKxD,KAAL,CAAW4B,MAAxC,CAD3B,CAlEJ,EAqEI,oBAAC,IAAD,CAAM,GAAN;AAAU,QAAA,KAAK,EAAE;AAAEoB,UAAAA,KAAK,EAAE,KAAT;AAAgBJ,UAAAA,OAAO,EAAE;AAAzB,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAC,SAAhB;AAA0B,QAAA,IAAI,EAAC,QAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADJ,CArEJ,CADJ,CADJ;AA+EH;;;;EA7McxE,S;;AAgNnB,eAAec,IAAf","sourcesContent":["import React, { Component } from 'react'\nimport { routes, route, trainsByRoute, classes, schedules } from '../Services'\n\nimport { Button, Form, Col, Row, Table } from 'react-bootstrap'\nimport Select from 'react-select'\nimport DatePicker from \"react-datepicker\"\nimport moment from 'moment'\n\nclass Home extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            fromOptions: [],\n            toOptions: [],\n            trains: [],\n            errMsg: 'Please fill all the fields!!!',\n            showErr: false,\n        };\n    }\n\n    componentDidMount() {\n        var options = []\n        routes()\n            .then(res => {\n                 res.map((item, i) => {\n                    return item.route.map((station, i) => {\n                        return options.push({ value: station.name, label: station.name, route: item._id, id: i, fair: station.fair })\n                    })\n                })\n                this.setState({ fromOptions: options })\n            })\n            .catch(err => {\n                console.log(err)\n            })\n            }\n//\n//        classes()\n//            .then(res => {\n//                var classes = []\n//                res.map((trainClass, i) => {\n//                    return classes.push({ value: trainClass.name, label: trainClass.name, id: trainClass._id, fairRatio: trainClass.fairRatio })\n//                })\n//                this.setState({ classes: classes })\n//            })\n//            .catch(err => {\n//                console.log(err)\n//            })\n//        schedules()\n//            .then(res => {\n//                var schedules = []\n//                res.map((schedule, i) => {\n//                    return schedules.push({ value: schedule.time, label: schedule.time, id: schedule._id })\n//                })\n//                this.setState({ schedules: schedules })\n//            })\n//            .catch(err => {\n//                console.log(err)\n//            })\n//\n//    }\n//\n//    handleChange = type => selectedOption => {\n//        this.setState({ [type]: selectedOption }, () => {\n//            this.calculateFair()\n//        });\n//        if (type === 'from') {\n//            this.setState({ to: '', train: '' })\n//            route(selectedOption.route)\n//                .then(res => {\n//                    var options = [];\n//                    res.route.map((station, i) => {\n//                        return options.push({ value: station.name, label: station.name, route: res._id, id: i, fair: station.fair })\n//                    })\n//                    this.setState({ toOptions: options })\n//                })\n//                .catch(err => {\n//                    console.log(err)\n//                })\n//            trainsByRoute(selectedOption.route)\n//                .then(res => {\n//                    var options = [];\n//                    res.map((train, i) => {\n//                        return options.push({ value: train.name, label: train.name, id: train._id })\n//                    })\n//                    this.setState({ trains: options })\n//                })\n//                .catch(err => {\n//                    console.log(err)\n//                })\n//        }\n//    }\n\n    handleQtyChange = () => event => {\n        this.setState({ qty: event.target.value }, () => this.calculateFair())\n    }\n\n    calculateFair = () => {\n        var user = localStorage.getItem('user')\n        if (user) {\n            user = JSON.parse(user)\n        }\n        if (this.state.to && this.state.from && this.state.trainClass && this.state.qty) {\n            var amount = Math.abs(this.state.to.fair - this.state.from.fair) * this.state.trainClass.fairRatio * this.state.qty\n            amount = amount.toFixed(2)\n            var discount = (user && user.discount ? 0.1 * amount : 0).toFixed(2)\n            var total = (amount - discount).toFixed(2)\n            this.setState({ amount: amount, discount: discount, total: total })\n        }\n    }\n\n    handleSubmit = event => {\n        this.setState({ showErr: false })\n        const state = this.state\n        var user = localStorage.getItem('user')\n        if (!user) {\n            alert(\"Please Sign In Before Make a Reservation!!!\")\n            this.props.history.push('/')\n        } else if (state.from && state.to && state.train && state.trainClass && state.time && state.qty && state.date) {\n            this.props.history.push(\"/payment\", { ...this.state })\n        } else {\n            this.setState({ showErr: true })\n        }\n        event.preventDefault()\n        event.stopPropagation()\n\n    }\n\n    handleDateChange = dt => {\n        const date = moment(dt).format('YYYY-MM-DD')\n        this.setState({ date: date })\n    }\n\n    render() {\n        return (\n            <Form style={{ padding: 20 }} onSubmit={(e) => this.handleSubmit(e)}>\n                <Row style={{ alignItems: 'center', justifyContent: 'center' }}>\n                    <Form.Row style={{ width: '75%', borderBottom: '1px solid rgb(200,200,200)', marginBottom: 20 }}>\n                        <h4>Book Train Tickets</h4>\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%' }}>\n                        <Form.Group as={Col} controlId=\"from\">\n                            <Form.Label>From</Form.Label>\n                            <Select options={this.state.fromOptions} onChange={this.handleChange(\"from\")} />\n                        </Form.Group>\n                        <Form.Group as={Col} controlId=\"to\">\n                            <Form.Label>To</Form.Label>\n                            <Select options={this.state.toOptions} onChange={this.handleChange(\"to\")} value={this.state.to} />\n                        </Form.Group>\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%' }}>\n                        <Form.Group as={Col} controlId=\"from\">\n                            <Form.Label>Train</Form.Label>\n                            <Select options={this.state.trains} onChange={this.handleChange(\"train\")} value={this.state.train} />\n                        </Form.Group>\n                        <Form.Group as={Col} controlId=\"to\">\n                            <Form.Label>Class</Form.Label>\n                            <Select options={this.state.classes} onChange={this.handleChange(\"trainClass\")} value={this.state.trainClass} />\n                        </Form.Group>\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%' }}>\n                        <Form.Group as={Col} controlId=\"from\">\n                            <Form.Label>Time</Form.Label>\n                            <Select options={this.state.schedules} onChange={this.handleChange(\"time\")} value={this.state.time} />\n                           </Form.Group>\n                        <Form.Group as={Col} controlId=\"formGridEmail\">\n                            <Form.Label>No of Tickets</Form.Label>\n                            <Form.Control placeholder=\"qty\" onChange={this.handleQtyChange()} />\n                        </Form.Group>\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%', paddingBottom: 20 }}>\n                        <Col md={6} lg={6} xl={6}>\n                            <Form.Label>Date</Form.Label>\n                            <DatePicker\n                                className=\"form-control\"\n                                onChange={this.handleDateChange}\n                                minDate={new Date()}\n                                value={this.state.date}\n                                placeholderText=\"YYYY-MM-DD\"\n                            />\n                        </Col>\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%', paddingLeft: 5, align: 'right' }}>\n                        {this.state.amount &&\n                            <Table striped bordered hover size=\"sm\">\n                                <tbody>\n                                    <tr>\n                                        <td align='right'>Amount</td>\n                                        <td align='right'>{this.state.amount} LKR</td>\n                                    </tr>\n                                    <tr>\n                                        <td align='right'>Discount</td>\n                                        <td align='right'>{this.state.discount} LKR</td>\n                                    </tr>\n                                    <tr>\n                                        <td align='right'>Total</td>\n                                        <td align='right'>{this.state.total} LKR</td>\n                                    </tr>\n                                </tbody>\n                            </Table>\n                        }\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%' }}>\n                        {this.state.showErr && <p style={{ color: 'red' }}>{this.state.errMsg}</p>}\n                    </Form.Row>\n                    <Form.Row style={{ width: '75%', padding: 5 }}>\n                        <Button variant=\"primary\" type=\"submit\">\n                            Make Reservation\n                        </Button>\n                    </Form.Row>\n                </Row>\n            </Form >\n        );\n    }\n}\n\nexport default Home;"]},"metadata":{},"sourceType":"module"}